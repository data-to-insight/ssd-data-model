
-- /* Development set up */

-- -- Point to correct DB/TABLE_CATALOG if required
-- USE HDM_Local; 
-- GO



-- /* ********************************************************************************************************** */
-- /* SSD extract set up */

-- -- ssd extract time-frame (YRS)
-- DECLARE @ssd_timeframe_years INT = 6;

-- -- check exists & drop
-- IF OBJECT_ID('ssd_person1') IS NOT NULL DROP TABLE ssd_person1;
-- IF OBJECT_ID('tempdb..#ssd_person1') IS NOT NULL DROP TABLE #ssd_person1;


-- -- Create structure
-- CREATE TABLE ssd_development.ssd_person1 (
--     pers_legacy_id          NVARCHAR(48),               -- metadata={"item_ref":"PERS014A"}               
--     pers_person_id          NVARCHAR(48) PRIMARY KEY,   -- metadata={"item_ref":"PERS001A"}   
--     pers_dob                DATETIME,                   -- metadata={"item_ref":"PERS005A"} 
--     pers_send_flag          NCHAR(5),                   -- metadata={"item_ref":"PERS008A", "item_status":"P"} 
--     pers_expected_dob       DATETIME,                   -- metadata={"item_ref":"PERS009A"}                  
--     pers_death_date         DATETIME,                   -- metadata={"item_ref":"PERS010A"} 
--     pers_is_mother          NCHAR(1),                   -- metadata={"item_ref":"PERS011A"}
-- );


-- -- Insert data
-- INSERT INTO ssd_person1 (
--     pers_legacy_id,
--     pers_person_id,
--     pers_dob,                                             
--     pers_expected_dob,
--     pers_death_date
-- )
-- SELECT
--     p.LEGACY_ID,
--     p.DIM_PERSON_ID,
--     CASE WHEN (p.DOB_ESTIMATED) = 'N'              
--         THEN p.BIRTH_DTTM                               -- Set to BIRTH_DTTM when DOB_ESTIMATED = 'N'
--         ELSE NULL 
--     END,                                                --  or NULL
--     CASE WHEN (p.DOB_ESTIMATED) = 'Y'              
--         THEN p.BIRTH_DTTM                               -- Set to BIRTH_DTTM when DOB_ESTIMATED = 'Y'
--         ELSE NULL 
--     END,                                                --  or NULL
--     p.DEATH_DTTM
   
-- FROM
--     Child_Social.DIM_PERSON AS p

-- -- (456348 rows without this filter:
-- WHERE p.DIM_PERSON_ID IS NOT NULL
-- AND p.DIM_PERSON_ID <> '-1' OR p.DIM_PERSON_ID <> -1
-- ;
 

-- -- Query 1: Filter by p.IS_CLIENT = 'Y'
-- /* Check exists & drop */
-- IF OBJECT_ID('ssd_person2') IS NOT NULL DROP TABLE ssd_person2;
-- IF OBJECT_ID('tempdb..#ssd_person2') IS NOT NULL DROP TABLE #ssd_person2;

-- /* Create structure */
-- CREATE TABLE ssd_development.ssd_person2 (
--     pers_legacy_id NVARCHAR(48),               -- metadata={"item_ref":"PERS014A"}               
--     pers_person_id NVARCHAR(48) PRIMARY KEY,   -- metadata={"item_ref":"PERS001A"}   
--     pers_dob DATETIME,                         -- metadata={"item_ref":"PERS005A"} 
--     pers_expected_dob DATETIME,                -- metadata={"item_ref":"PERS009A"}                  
--     pers_death_date DATETIME                  -- metadata={"item_ref":"PERS010A"} 
-- );

-- /* Insert data */
-- INSERT INTO ssd_person2 (
--     pers_legacy_id,
--     pers_person_id,
--     pers_dob,                                             
--     pers_expected_dob,
--     pers_death_date
-- )
-- SELECT
--     p.LEGACY_ID,
--     p.DIM_PERSON_ID,
--     CASE WHEN (p.DOB_ESTIMATED) = 'N' THEN p.BIRTH_DTTM ELSE NULL END,
--     CASE WHEN (p.DOB_ESTIMATED) = 'Y' THEN p.BIRTH_DTTM ELSE NULL END,
--     p.DEATH_DTTM
-- FROM
--     Child_Social.DIM_PERSON AS p
-- WHERE 
--     p.DIM_PERSON_ID IS NOT NULL
--     AND p.DIM_PERSON_ID <> '-1'
--     AND p.DIM_PERSON_ID <> -1
--     AND p.IS_CLIENT = 'Y';


-- -- Query 2: Filter by Child_Social.FACT_CONTACTS

-- /* Check exists & drop */
-- IF OBJECT_ID('ssd_person3') IS NOT NULL DROP TABLE ssd_person3;
-- IF OBJECT_ID('tempdb..#ssd_person3') IS NOT NULL DROP TABLE #ssd_person3;

-- /* Create structure */
-- CREATE TABLE ssd_development.ssd_person3 (
--     pers_legacy_id NVARCHAR(48),               -- metadata={"item_ref":"PERS014A"}               
--     pers_person_id NVARCHAR(48) PRIMARY KEY,   -- metadata={"item_ref":"PERS001A"}   
--     pers_dob DATETIME,                         -- metadata={"item_ref":"PERS005A"} 
--     pers_expected_dob DATETIME,                -- metadata={"item_ref":"PERS009A"}                  
--     pers_death_date DATETIME                  -- metadata={"item_ref":"PERS010A"} 
-- );

-- /* Insert data */
-- INSERT INTO ssd_person3 (
--     pers_legacy_id,
--     pers_person_id,
--     pers_dob,                                             
--     pers_expected_dob,
--     pers_death_date
-- )
-- SELECT
--     p.LEGACY_ID,
--     p.DIM_PERSON_ID,
--     CASE WHEN (p.DOB_ESTIMATED) = 'N' THEN p.BIRTH_DTTM ELSE NULL END,
--     CASE WHEN (p.DOB_ESTIMATED) = 'Y' THEN p.BIRTH_DTTM ELSE NULL END,
--     p.DEATH_DTTM
-- FROM
--     Child_Social.DIM_PERSON AS p
-- WHERE 
--     p.DIM_PERSON_ID IS NOT NULL
--     AND p.DIM_PERSON_ID <> '-1'
--     AND p.DIM_PERSON_ID <> -1
--     AND EXISTS (
--         SELECT 1 
--         FROM Child_Social.FACT_CONTACTS fc
--         WHERE fc.DIM_PERSON_ID = p.DIM_PERSON_ID
--         AND fc.CONTACT_DTTM >= DATEADD(YEAR, -@ssd_timeframe_years, GETDATE())
--     );




-- -- Query 3: Filter by Child_Social.FACT_REFERRALS
-- /* Check exists & drop */
-- IF OBJECT_ID('ssd_person4') IS NOT NULL DROP TABLE ssd_person4;
-- IF OBJECT_ID('tempdb..#ssd_person4') IS NOT NULL DROP TABLE #ssd_person4;

-- /* Create structure */
-- CREATE TABLE ssd_development.ssd_person4 (
--     pers_legacy_id NVARCHAR(48),               -- metadata={"item_ref":"PERS014A"}               
--     pers_person_id NVARCHAR(48) PRIMARY KEY,   -- metadata={"item_ref":"PERS001A"}   
--     pers_dob DATETIME,                         -- metadata={"item_ref":"PERS005A"} 
--     pers_expected_dob DATETIME,                -- metadata={"item_ref":"PERS009A"}                  
--     pers_death_date DATETIME                  -- metadata={"item_ref":"PERS010A"} 
-- );

-- /* Insert data */
-- INSERT INTO ssd_person4 (
--     pers_legacy_id,
--     pers_person_id,
--     pers_dob,                                             
--     pers_expected_dob,
--     pers_death_date
-- )
-- SELECT
--     p.LEGACY_ID,
--     p.DIM_PERSON_ID,
--     CASE WHEN (p.DOB_ESTIMATED) = 'N' THEN p.BIRTH_DTTM ELSE NULL END,
--     CASE WHEN (p.DOB_ESTIMATED) = 'Y' THEN p.BIRTH_DTTM ELSE NULL END,
--     p.DEATH_DTTM
-- FROM
--     Child_Social.DIM_PERSON AS p
-- WHERE 
--     p.DIM_PERSON_ID IS NOT NULL
--     AND p.DIM_PERSON_ID <> '-1'
--     AND p.DIM_PERSON_ID <> -1
--     AND EXISTS (
--         SELECT 1 
--         FROM Child_Social.FACT_REFERRALS fr
--         WHERE fr.DIM_PERSON_ID = p.DIM_PERSON_ID
--         AND (
--             fr.REFRL_START_DTTM >= DATEADD(YEAR, -@ssd_timeframe_years, GETDATE()) 
--             OR fr.REFRL_END_DTTM >= DATEADD(YEAR, -@ssd_timeframe_years, GETDATE()) 
--             OR fr.REFRL_END_DTTM IS NULL
--         )
--     );




-- -- Create the table
-- CREATE TABLE ssd_person_cincplac (
--     pers_person_id NVARCHAR(48) PRIMARY KEY
-- );

-- -- Insert the list of pers_person_id values
-- INSERT INTO ssd_person_cincplac (pers_person_id)
-- VALUES
--  (7203275),(7203291),(7203342),(7203343),(7203350),(7203351),(7203352),(7203353),(7044044),(117405),(7044115),(7044116),(156355),(7203443),(156440),(156450),(156553),(156604),(7044173),(7126933),(7203534),(7203535),(118205),(118318),(156607),(156708),(156709),(156711),(156712),(7044408),(7044423),(7044429),(7044434),(7044435),(7044436),(7044439),(118681),(7203644),(7203649),(7203801),(156930),(118907),(119087),(7203825),(7203837),(7203839),(7203846),(7203941),(7203944),(119264),(119450),(157024),(157099),(157164),(119742),(119940),(157181),(7204050),(120203),(120281),(120378),(120389),(120400),(120469),(120788),(7204222),(121150),(7204425),(7204426),(7045360),(7045370),(7204495),(7204576),(7128060),(121685),(121698),(7045542),(158056),(7204740),(7204745),(7045759),(122560),(7204851),(7045865),(122835),(122925),(7045936),(7045993),(7205054),(123227),(123229),(123317),(123323),(7128651),(7046029),(7046030),(7046136),(7046189),(7205159),(7205169),(7205308),(158768),(158776),(124063),(124071),(124166),(7046227),(124636),(124638),(158865),(158879),(158965),(7205515),(7046421),(7046566),(124920),(159146),(7046611),(7046612),(7046614),(7046615),(7205537),(7205556),(125184),(125374),(125385),(7205613),(159279),(159362),(159373),(125752),(7046799),(7046800),(7046863),(7205713),(7205821),(126024),(7047041),(126300),(126322),(126329),(126336),(126425),(7205914),(7047258),(7047259),(7047262),(159804),(127231),(127240),(127540),(127703),(127727),(160120),(7206375),(7047532),(7047533),(7047540),(128028),(128100),(128108),(7047696),(160195),(128495),(7047800),(7047803),(7047888),(160475),(160479),(160484),(160489),(160490),(160493),(128766),(128840),(7048011),(160584),(129221),(129325),(7206758),(7206813),(7048200),(129398),(129437),(129706),(160864),(7206918),(129790),(130004),(130064),(130084),(160967),(7048450),(7130697),(130162),(130174),(130439),(161126),(7048479),(130551),(130645),(130750),(130829),(7048491),(7048493),(131093),(131095),(131198),(161320),(161351),(161352),(7048748),(131368),(131489),(131490),(161629),(161631),(7207421),(131661),(131947),(131955),(131956),(132325),(7049126),(7049127),(132510),(133105),(133187),(133381),(133384),(133437),(7207975),(162248),(162250),(162351),(162352),(162358),(133742),(134009),(7049678),(7049679),(162524),(7208236),(134471),(134487),(134495),(134599),(134665),(134758),(134790),(7208429),(134971),(135038),(7132221),(7050059),(7050062),(135336),(7208698),(7050192),(7050241),(7050336),(135695),(135800),(135811),(135813),(135814),(163099),(163113),(163119),(7050376),(135998),(136167),(163330),(7208750),(163491),(7050624),(7208901),(7208914),(7208915),(136764),(137027),(137028),(7209064),(7209065),(137330),(137417),(137513),(137757),(137758),(163882),(163885),(137965),(138051),(7209296),(163941),(138239),(138252),(138516),(138720),(138725),(138735),(138736),(7051216),(7133431),(164145),(164222),(164253),(164259),(164312),(138810),(138889),(139024),(139116),(139374),(139453),(139459),(139470),(7209680),(164635),(7051751),(140115),(140248),(7051833),(7209850),(164691),(164692),(164695),(164723),(140327),(140330),(140412),(140488),(140579),(140605),(7051885),(7210052),(140799),(7210207),(7210218),(141052),(165069),(165077),(165084),(165085),(7210316),(7210392),(67791),(141805),(141813),(141837),(142021),(7210575),(7052526),(165449),(165479),(142200),(142365),(142388),(7210613),(7210701),(7052603),(7052607),(142575),(142576),(165756),(165757),(7052780),(142932),(142934),(143147),(143153),(143211),(7210793),(166107),(166117),(166129),(166130),(143788),(143793),(7211162),(166326),(7211282),(144560),(144624),(144630),(144724),(166383),(166386),(145016),(7211351),(7211362),(166575),(145376),(7053635),(7053640),(7053644),(166856),(7211655),(7135674),(7053733),(7053815),(7053822),(146225),(146237),(146251),(146338),(146420),(146426),(166970),(166972),(7053929),(146504),(146513),(146514),(146788),(7054028),(167178),(7054193),(7054197),(146912),(146913),(147072),(147157),(147192),(7212032),(147344),(147477),(167605),(147737),(7212225),(7054521),(7054522),(7054523),(7054596),(7054597),(148136),(167721),(7212312),(148693),(7054707),(7054859),(167888),(167894),(167895),(167896),(148892),(149070),(70821),(7212599),(7054872),(149232),(149432),(7212697),(7212784),(168296),(149722),(149730),(168380),(7055157),(7137023),(7137024),(168454),(168461),(149894),(150011),(168574),(7212952),(7055327),(7055419),(150277),(150280),(150281),(150293),(150295),(150296),(150306),(150582),(150752),(7137177),(168641),(7055454),(7055463),(7055517),(7055526),(150942),(7213170),(168864),(7137368),(151489),(7213271),(7213345),(169046),(169048),(151584),(151585),(151614),(151679),(7213428),(7213430),(152142),(152145),(169220),(72146),(7137645),(152335),(152357),(152358),(152360),(152363),(152427),(152527),(152610),(152638),(7056160),(7056172),(7213637),(7056198),(153192),(153193),(153207),(7213835),(7056471),(7056481),(153476),(153477),(153491),(153554),(153656),(153681),(169769),(7214002),(7056660),(7056665),(154151),(7214118),(154243),(170265),(170281),(7214268),(154628),(154811),(170358),(170359),(155257),(155259),(155278),(7138584),(7138689),(155630),(7057208),(170626),(7138778),(7214644),(156001),(170806),(7057320),(7057419),(156116),(156209),(156321),(156474),(156586),(156767),(156768),(156777),(156786),(7139150),(171192),(157046),(157063),(157327),(171199),(7214960),(7057705),(7057706),(7057709),(7057710),(74098),(157703),(171378),(7139431),(7057929),(7057990),(7058001),(7058003),(157784),(157802),(157904),(7215154),(7058103),(7058105),(7058195),(171742),(171750),(158830),(74679),(74754),(7215524),(171840),(158927),(7215594),(7058469),(7058493),(7058625),(7058626),(172043),(7215724),(159766),(159952),(160044),(172212),(160267),(7215881),(7215990),(7058914),(160449),(160719),(7059052),(7059060),(7059181),(160817),(160907),(160913),(160990),(161186),(161195),(161395),(161465),(161466),(161467),(161468),(75864),(161576),(161672),(161832),(161928),(162017),(162018),(162025),(162110),(162111),(162140),(162210),(7216448),(7216523),(7140859),(76282),(162314),(162317),(162333),(162420),(162522),(162594),(162604),(7059772),(163144),(163169),(163184),(173451),(163282),(163331),(163333),(7201909),(163531),(7216920),(173569),(7059993),(7202001),(163613),(163717),(7202168),(7202265),(163817),(163893),(7202367),(7060073),(7060077),(7060078),(7060079),(7060080),(7060139),(7060144),(7217129),(7202445),(7202567),(164213),(76917),(164386),(7202954),(7202955),(7202958),(7203016),(164587),(164666),(174020),(7203147),(7203215),(164826),(7203321),(7203379),(164960),(174092),(174226),(77272),(7060555),(7060556),(7060630),(7060631),(7060635),(7203585),(165120),(165129),(7203677),(7203683),(7203684),(7203688),(7203785),(7203797),(165315),(174399),(165611),(165626),(165627),(165797),(165798),(7060733),(7060750),(174469),(174501),(174580),(7217668),(7204708),(7204710),(7204733),(166434),(166560),(7217753),(7217757),(7217852),(166836),(7205278),(167001),(167002),(7061275),(7061276),(167021),(7205407),(167306),(7205638),(7205651),(7205655),(7217957),(7218023),(7218044),(7218102),(7218114),(175038),(175040),(175145),(7061366),(167466),(7205833),(7206050),(167749),(7061442),(7142559),(7142632),(175238),(175318),(175350),(167776),(167789),(167942),(167951),(7206404),(168143),(7218239),(7061633),(7142727),(168351),(168446),(7218316),(7218346),(168915),(168976),(168983),(78803),(175691),(169190),(169261),(169269),(7207451),(7218527),(7218589),(7218607),(7218627),(169481),(169538),(7207723),(169641),(169650),(175913),(7062212),(7207915),(169828),(170018),(170139),(7208193),(7218786),(7218787),(176083),(7062337),(7062390),(7208221),(7208395),(7208411),(7208465),(170475),(176165),(7218986),(7062414),(7208598),(7208605),(170610),(170672),(7208874),(170798),(7208946),(7209032),(7209161),(171167),(7219093),(7219094),(7143680),(7143681),(7209425),(171336),(7209540),(171541),(171611),(171728),(171729),(7209714),(7209799),(7209811),(171891),(7209924),(176726),(172198),(7210108),(172362),(172364),(172374),(7210296),(172460),(172462),(172463),(172464),(7219476),(7219483),(7219559),(7219629),(172544),(7210552),(7210666),(7210741),(7210753),(80393),(80394),(7144133),(177223),(7063245),(7063277),(7063278),(7063279),(7063339),(172926),(172929),(7210840),(7210845),(7210917),(7210918),(173024),(173045),(7219752),(177288),(7211218),(7211232),(7211327),(173412),(7211426),(7063447),(7219862),(7219950),(7219951),(7219952),(7211698),(173764),(177572),(174066),(174082),(7212082),(174150),(174235),(177757),(177787),(7212446),(174524),(174815),(174827),(7063894),(177894),(177963),(7220202),(7220203),(7212629),(174904),(174923),(7212716),(7212723),(7212725),(175115),(7220311),(7220316),(7064022),(178132),(7212940),(7213210),(7213220),(175585),(175593),(7064198),(7064209),(7064212),(7064269),(175658),(7213581),(7213582),(175923),(178411),(7064312),(7064322),(7064323),(7064393),(7064402),(7064403),(7064458),(176036),(7145289),(81900),(7214153),(7214233),(7064482),(7064583),(178620),(7214500),(7214514),(7214515),(176796),(7214595),(176978),(177068),(7214787),(7214807),(178640),(178641),(7220877),(7064694),(177244),(177272),(7214994),(7215107),(178798),(7221046),(7221047),(7221054),(7215187),(7215192),(177536),(177748),(177798),(177800),(7215366),(7215466),(7064889),(7064947),(7065027),(7145745),(7145748),(178005),(7215631),(7215765),(82633),(82667),(7065056),(7065155),(7065211),(179168),(179169),(179178),(7216121),(7216207),(7221345),(7221508),(7065266),(178683),(178690),(179371),(179454),(7065329),(7065332),(7216670),(7216675),(7216696),(7216705),(7216706),(7216707),(7216795),(179238),(179414),(179420),(179724),(7065444),(7065512),(7065607),(7065609),(7221622),(179427),(179494),(7217263),(179785),(179751),(179868),(179888),(7217517),(179990),(180068),(180030),(180179),(7217809),(7217888),(180344),(7218100),(7218101),(7065967),(7221933),(7221984),(180654),(180655),(180808),(7218173),(180223),(180225),(7146673),(7065994),(7066078),(180428),(7222089),(7222111),(7222112),(7222195),(7222255),(7218775),(181685),(181686),(7066288),(7066339),(180506),(180507),(181868),(182035),(182036),(7219488),(7222354),(7222356),(7222447),(7066528),(182221),(182330),(7219809),(7222551),(7219985),(182727),(182800),(182822),(180885),(183294),(7220633),(7066852),(7066856),(7066927),(7066928),(84723),(181051),(181070),(181140),(7222721),(7222722),(7220653),(7220654),(7220752),(183366),(183372),(183380),(183662),(7067113),(181237),(183837),(183924),(184027),(7221295),(7222837),(7222843),(7223001),(85097),(184127),(184313),(184315),(184317),(184407),(7067145),(181444),(7067206),(7067301),(184594),(7221841),(7221842),(184681),(184693),(7221934),(7221945),(7223113),(181630),(7222121),(7222414),(185230),(85449),(7148085),(7223383),(7223386),(185453),(185454),(7222693),(7222704),(7222773),(185612),(7067526),(185626),(185693),(7222982),(7222983),(7222986),(7222987),(7222989),(185814),(185831),(185884),(185885),(185928),(7223150),(7223162),(7223424),(7223569),(7067852),(186009),(186283),(186300),(7223471),(7223473),(7223539),(182216),(7148399),(7067960),(7068038),(7223644),(7223661),(7223665),(7223737),(186753),(186837),(186852),(7223830),(85958),(7223588),(7223689),(7223690),(7068177),(7223952),(187316),(187340),(7224418),(7224505),(187509),(187510),(182647),(7068268),(7068415),(7068416),(7068437),(187678),(187679),(187695),(187704),(187900),(187954),(182870),(7223983),(7224136),(86484),(7068453),(188065),(188087),(188177),(7225157),(7225165),(7225168),(7225227),(188329),(183029),(183040),(188440),(7225520),(188626),(188627),(188648),(7068807),(183250),(189024),(7226086),(7149253),(7226160),(189292),(189298),(183432),(183433),(7149312),(7149319),(7149320),(7149344),(7224646),(189841),(189850),(7226668),(7226671),(7226744),(189939),(189940),(7069020),(87360),(183584),(183585),(7226850),(7226851),(7226921),(7227037),(190309),(190310),(183856),(183858),(190402),(190409),(190429),(190501),(7069358),(7069371),(87617),(87734),(190703),(190800),(191002),(191053),(191069),(191070),(183999),(7069409),(7069564),(7227953),(191383),(191384),(7228141),(7228166),(7228170),(184159),(7069579),(7069581),(7069737),(88015),(191471),(191472),(7228353),(7228360),(191733),(7228549),(7228557),(7228612),(7228614),(7228632),(7228637),(191816),(191832),(184266),(184267),(184268),(7150157),(7069765),(191926),(7228706),(7228731),(7228814),(7228983),(7069849),(7069928),(7069929),(7069930),(7069931),(7069932),(7069933),(184556),(184560),(192402),(7229292),(192565),(7069972),(7070055),(192749),(7229559),(7229567),(192954),(193038),(7229659),(184740),(7225504),(88566),(7229677),(7229678),(7229680),(7229769),(193170),(7229841),(193428),(193429),(193430),(193444),(7070159),(7070165),(7070249),(7070304),(7225673),(193600),(7230340),(193696),(193697),(193698),(193713),(193714),(7150657),(7150749),(185099),(7230428),(7230598),(7230724),(88964),(7070602),(7070621),(7070687),(7225840),(7225874),(7230887),(7230888),(7230997),(194467),(185229),(7226004),(89136),(89247),(7070733),(7070780),(7231279),(194755),(185500),(89315),(7151116),(195039),(195127),(195128),(7070905),(185595),(7232036),(195398),(195614),(195691),(7226244),(185767),(185850),(7232319),(7232487),(7232488),(7071079),(196166),(196250),(196262),(196346),(196350),(196360),(196440),(7232865),(7232876),(196528),(185950),(185958),(186058),(7071298),(7233071),(196811),(7233246),(7233247),(7233252),(7233253),(7233321),(7233346),(7233348),(186221),(7071456),(7071463),(7071529),(196919),(196999),(7233438),(7233443),(197108),(197116),(7233632),(7233634),(7233694),(7233697),(7233699),(7233701),(7233732),(186334),(186405),(197298),(197386),(7233878),(197548),(7233995),(7234083),(7226860),(7226879),(7226894),(7226942),(7226953),(7234299),(197845),(197853),(7071852),(7226972),(7234651),(198217),(198231),(198301),(198338),(7227055),(7227081),(7227149),(186716),(186786),(186798),(7072052),(198495),(198680),(198710),(7072187),(90927),(198975),(198976),(199176),(7235494),(91120),(7072208),(7072216),(7072229),(7072237),(187105),(7235604),(7235702),(199540),(7227524),(7072479),(7235979),(199709),(199727),(7236058),(199921),(199922),(199930),(199997),(187261),(187265),(187344),(187361),(7227534),(7227559),(7227567),(200191),(200192),(7236441),(200271),(7236614),(7236616),(187485),(187486),(7236713),(7236716),(7236725),(7236982),(7227831),(200877),(200930),(200931),(200932),(200939),(7237186),(7237284),(201035),(201117),(7237369),(91852),(187847),(187916),(7237383),(201310),(201314),(201315),(201320),(7237659),(201399),(201407),(201408),(7072976),(7072986),(7073039),(7073040),(7073044),(7073066),(92059),(7228094),(201715),(201884),(7238033),(201971),(188136),(7073257),(7073310),(202007),(7238211),(7238212),(202269),(202276),(202277),(202278),(7238423),(202337),(202338),(188190),(188198),(188202),(188203),(202364),(7238722),(7073341),(7073447),(7228399),(7228401),(7228463),(7228464),(7228465),(7228467),(202740),(7239094),(188408),(7073625),(7073688),(7239255),(7239332),(7239361),(203284),(7239468),(7239517),(7239522),(7239554),(7228482),(7228492),(188601),(188691),(188696),(7228592),(7239721),(7239723),(7239747),(203849),(7073742),(188787),(188878),(188894),(7228702),(203962),(204053),(204054),(204130),(204131),(204159),(7240215),(7074012),(204263),(204345),(204433),(204495),(204521),(204522),(204525),(188965),(188968),(188985),(189079),(189080),(7074207),(204706),(204827),(7240757),(7240771),(204978),(204991),(7228956),(7228958),(189264),(7000086),(7241137),(7241139),(7000215),(7074460),(7229125),(7229127),(7229131),(7229162),(7229163),(189425),(7241594),(7241595),(7241596),(7241604),(7000663),(7229212),(7074494),(7074651),(7241704),(7241788),(7241876),(7001052),(7001054),(7229341),(7074666),(7074667),(7074668),(7074669),(7001145),(7001168),(7242261),(7242379),(7242380),(7001426),(7001427),(7074825),(7229438),(7242470),(7001524),(7001545),(7001600),(7242653),(7001807),(7001812),(7001815),(7229531),(7229536),(189906),(94191),(7242927),(7001983),(7001991),(7243032),(7243094),(7243190),(7229634),(7002354),(7243386),(7002540),(7002560),(7002566),(7002567),(94405),(7075122),(7075123),(7075207),(7243578),(7243591),(7002853),(7002862),(7002926),(7243753),(7243849),(7003034),(190375),(190376),(7075234),(7075313),(7075393),(7243947),(7243964),(7244051),(7003229),(7003230),(7003231),(7003243),(7244221),(7003394),(94868),(190577),(7003617),(7003618),(7003676),(94967),(190669),(190672),(190728),(190744),(7003797),(7003862),(7244814),(7003986),(7004047),(7244880),(7244915),(7075629),(7075760),(7230354),(7004226),(7245276),(190833),(7075868),(7004553),(7004639),(7004640),(7245564),(7245565),(7245676),(7004899),(7230454),(191052),(191131),(7075988),(7004993),(7245823),(7245951),(7005091),(7005108),(7246011),(7246111),(7076152),(191385),(7005311),(7005474),(7005476),(7005676),(7005762),(7005849),(7005866),(7246666),(7246693),(7006122),(7006123),(7006127),(191508),(96002),(7076369),(7076432),(7006222),(7006223),(7006322),(7246973),(7247072),(191606),(191672),(191681),(191706),(96192),(7230929),(7247435),(7006793),(7006794),(7006895),(191774),(191776),(7247538),(7247810),(7247811),(7007180),(7007181),(7007182),(7007184),(7076895),(191951),(191981),(7248273),(7248274),(7248277),(7231136),(7231206),(7231215),(192159),(7248374),(7248379),(7248576),(7007919),(7007921),(192253),(7077000),(7077001),(7077099),(7231317),(7231415),(7248748),(7008193),(192334),(192367),(7077277),(7231500),(7249043),(7008503),(7008506),(7008589),(7231590),(7231595),(7231661),(7249399),(7249487),(7249520),(7009056),(7249626),(7249682),(7249695),(7249702),(7009229),(7009239),(7077381),(7077390),(97237),(7250076),(7231791),(192717),(192792),(192887),(97413),(7250456),(7231863),(7231981),(7010075),(7250549),(7250550),(7250557),(7250635),(7250661),(7250738),(7250799),(7250820),(7010358),(97603),(7010455),(7010457),(7010626),(7010813),(7251283),(7251313),(7011024),(7251497),(7011133),(7232273),(193467),(7251651),(7251667),(7251760),(7251779),(7011402),(193584),(98153),(7011573),(7011597),(7011598),(7011767),(7252143),(7011872),(7252241),(7232460),(7252340),(7252419),(7252420),(7252428),(7252441),(7012327),(193833),(193834),(193850),(98627),(98698),(98700),(7012436),(7252799),(7252908),(7012733),(194051),(7253093),(7253284),(7013076),(194232),(194247),(7253457),(7253658),(7253666),(194415),(7253929),(7253930),(7013838),(7013839),(7013840),(7013841),(7013842),(7254106),(194491),(194523),(7254190),(7254405),(7254406),(7014141),(7233268),(7233308),(194592),(7254782),(7254783),(7254787),(194800),(7233459),(7014784),(7014792),(7014793),(7015098),(7015099),(99672),(7255229),(7255236),(7255321),(7255332),(7255438),(7255498),(7015445),(7233675),(195254),(100052),(7233765),(7233781),(7233847),(7256080),(7256174),(7256199),(7256254),(100335),(7233945),(7016472),(7256556),(7256634),(7256638),(7256641),(7256646),(7016589),(7016590),(7234019),(195525),(195566),(195628),(7016685),(7256834),(7256928),(7257029),(7016943),(195720),(195803),(7257231),(7017137),(7257404),(7257422),(7017542),(7234415),(7234417),(7234440),(7234446),(196089),(7017890),(7017898),(7017899),(7257874),(7018161),(7018167),(7258059),(196205),(7234622),(7258150),(7258165),(7258169),(7018358),(7018361),(7258255),(7258256),(7018540),(7018559),(7018560),(196310),(196311),(196379),(7258520),(7018845),(7018846),(7018848),(7234694),(7234709),(7234710),(196475),(196501),(101540),(7259202),(101623),(7259366),(7259487),(7019602),(7259576),(7234981),(196881),(196943),(196960),(7259836),(7259921),(7259954),(7235103),(101900),(7260016),(7020149),(197049),(197070),(197121),(197128),(7020814),(7235282),(7021003),(7260709),(7260710),(7260759),(7021089),(7021113),(7021114),(7021167),(7021184),(7260970),(7260977),(7260987),(7021307),(7021368),(7261063),(7261064),(7261102),(197443),(197514),(7021876),(7021945),(7261626),(7261647),(197607),(197613),(197614),(197615),(7262119),(7262126),(7235754),(7262305),(7262399),(7262403),(197900),(197901),(7235836),(7022977),(7022978),(7022979),(7262793),(7263062),(7023434),(7263215),(7263225),(7263226),(198059),(198080),(7236122),(7023826),(7024027),(198190),(7263605),(7024105),(7024106),(7024122),(7024399),(7263974),(7236199),(198354),(198363),(7263976),(7024499),(7264172),(7264360),(7026047),(7026074),(7026075),(198662),(7264935),(7026443),(7026518),(7026519),(7265029),(7236571),(7236651),(7236671),(7236735),(7265486),(7027012),(7027015),(7265566),(7265674),(7027393),(7265941),(7027764),(7027765),(7027819),(7028011),(7028014),(7028021),(7266318),(7236939),(7236940),(7266728),(7028586),(7266923),(7266993),(7028774),(7028776),(7028777),(7267097),(7267104),(7267106),(7028882),(7028962),(7028965),(7028966),(7028967),(7029078),(7029083),(7029141),(7030223),(199689),(199751),(199765),(199840),(7237353),(7030594),(7030595),(7030652),(7030981),(7030983),(7031034),(7031054),(199969),(7031597),(7031896),(7032185),(7032559),(7032646),(7237679),(200054),(200055),(200056),(200144),(200151),(7032742),(7033028),(7237816),(200338),(200348),(7033795),(7033871),(7033978),(7033979),(105512),(7034555),(7034560),(200531),(7035932),(7238086),(7036492),(7036603),(7036784),(7036787),(7036866),(7036867),(7036868),(7036885),(7036886),(7036972),(7037238),(7037445),(7037629),(7037829),(201007),(201009),(7038502),(7038691),(7038703),(106409),(7038933),(7039041),(7039042),(7039077),(7039423),(7039431),(7039432),(7039434),(7238561),(201193),(7039695),(7039818),(7040176),(201458),(7040443),(7040459),(7040649),(7040836),(7040838),(106810),(106926),(7041217),(7041388),(7041520),(7041685),(7041687),(201546),(201643),(7041896),(107102),(7043532),(7043900),(7043907),(7044072),(7044074),(7044079),(7044080),(7044103),(107181),(107204),(107206),(107294),(7044445),(7044562),(7044569),(201918),(201938),(201939),(202009),(202010),(7045140),(7045575),(7045700),(7045701),(7239301),(202121),(202226),(202227),(202228),(7045771),(7045991),(7046520),(107654),(107656),(107657),(202295),(7046627),(7046662),(7239407),(7239471),(7239481),(7239566),(107731),(7047291),(7047292),(7047305),(7047566),(7047771),(7047788),(7047854),(202515),(202597),(7048057),(7048058),(7048401),(7048422),(7048542),(7048543),(107930),(7239573),(7239706),(7048777),(7048803),(7048980),(7048981),(202667),(108139),(7049159),(7049161),(7049163),(7049270),(202863),(7049638),(7049826),(7049827),(7050102),(7240054),(7240124),(108607),(203054),(203060),(7050602),(7050604),(7050605),(7050686),(7050785),(7050786),(108696),(108775),(7051141),(7240174),(108890),(108965),(7051520),(7051525),(109147),(7051928),(7051996),(7052160),(7052170),(7052183),(7240542),(109341),(203911),(203912),(203923),(7052745),(7052845),(109417),(109548),(7053110),(7053289),(7053290),(7053297),(204084),(204087),(204093),(204096),(109641),(7053401),(7053403),(7053405),(7053406),(204171),(204273),(204300),(109834),(109835),(109905),(7053777),(7053778),(7053779),(7053799),(7053800),(7053866),(204370),(7054174),(7054337),(7054360),(7054433),(7054434),(7241159),(7054623),(7054643),(204683),(7055011),(7055196),(7241297),(204846),(204869),(7055357),(110389),(7241489),(7055656),(7055735),(204934),(204944),(204945),(110654),(7056057),(7056121),(7056239),(7241656),(205135),(7000065),(7000074),(7000077),(7056495),(7056610),(110942),(7000245),(7000246),(7241858),(7241937),(7057382),(7057431),(7057434),(7057755),(111310),(111327),(111428),(7000532),(7000533),(7000548),(7058208),(111501),(7242240),(7242242),(7058771),(7000714),(7000734),(7058911),(7058912),(7058913),(7059180),(111807),(7242433),(7000916),(7001088),(7242498),(7059341),(7059525),(7059851),(7059916),(7059917),(7059918),(7001267),(7242686),(7060223),(7060224),(7060461),(7060496),(7001308),(7001384),(112240),(112281),(112372),(7060954),(7061051),(7061052),(7061055),(7242902),(7001476),(112434),(7061351),(7061421),(112534),(112548),(7243055),(7061704),(7061723),(7061724),(7061794),(7061795),(7061802),(13968),(7001665),(7062103),(7062177),(7001883),(7002028),(112820),(7002060),(7002131),(7002140),(7002148),(7062747),(14948),(113091),(113096),(113112),(113124),(7063234),(7063671),(7063673),(7063681),(7243653),(7064047),(113507),(7002597),(7064372),(7243835),(113556),(7064603),(7064746),(7002703),(7065100),(7065171),(7065179),(7065184),(113853),(113863),(113864),(7002822),(7002882),(7002884),(7002885),(7002886),(7002966),(7243996),(7065304),(7065391),(113973),(7065662),(7065843),(7065942),(7065948),(7065949),(7065950),(7066135),(7066242),(7066253),(7066313),(114221),(7003327),(7003335),(7066416),(7066419),(7066491),(7066493),(7066494),(114426),(7066988),(7066989),(7067087),(7003455),(7003539),(114609),(7067178),(7067539),(7003621),(7067547),(7067633),(7067655),(7067751),(7067816),(7067817),(7003657),(7003714),(14023),(7092147),(7067934),(7067939),(7068307),(7003891),(7244738),(7244765),(7244779),(114885),(7068402),(7003951),(7004005),(115095),(115096),(7244856),(7244858),(7069131),(7004122),(7004275),(115263),(115347),(7069628),(7069700),(7069701),(7069708),(7245034),(7245128),(7004389),(7069986),(115473),(115544),(115620),(7070268),(7070270),(7070376),(7070446),(7070587),(7245306),(115660),(7070844),(7070959),(7071012),(115936),(115993),(7071130),(7004693),(7004706),(7004754),(7245509),(7245528),(7071416),(7071417),(7071601),(116017),(7004963),(7245600),(7071789),(7071790),(7245706),(116189),(7072079),(7072080),(7072340),(7072355),(7072445),(116316),(7005077),(7005079),(7005080),(7005135),(7005163),(7072526),(7072701),(7245799),(7245866),(7245898),(7073035),(7073108),(7073109),(7073189),(7073191),(7073272),(116582),(116604),(7073394),(7073465),(7073585),(7073587),(7073588),(7246061),(7246091),(7005427),(7005446),(7005597),(7005601),(7073678),(7073780),(116786),(116787),(7093847),(7005612),(7005638),(7005702),(7005703),(7074051),(7246254),(117034),(7074418),(7074419),(7074534),(7074605),(7074809),(7074895),(7246343),(7246363),(7246518),(7005987),(7075281),(7075282),(7075283),(7075284),(7075285),(7075370),(117435),(7075565),(7075566),(7246540),(7246634),(117508),(7076032),(7076201),(7246756),(7076690),(7076691),(7246812),(7246829),(7006389),(7006398),(7006532),(117819),(7076804),(7006566),(7006575),(117973),(117982),(7077251),(7006727),(7006729),(7077446),(7006824),(7247203),(118296),(118361),(118377),(7006944),(7007030),(7007034),(7247299),(118445),(7007204),(7007221),(118631),(7247470),(7247488),(7247555),(7247558),(118834),(7007513),(7247669),(119012),(119021),(119022),(7007688),(7007689),(119199),(119237),(7247939),(7007974),(119387),(7248145),(7248148),(7008142),(7008163),(7248316),(7008404),(7008405),(7008406),(7008433),(120055),(7248413),(7248419),(7248586),(120140),(120271),(7008632),(7008634),(7008644),(7008646),(7008722),(7008792),(7008793),(7248706),(7248715),(120447),(7008829),(7248876),(7248886),(7248888),(7248890),(7248894),(120526),(7008997),(7009030),(7009076),(120804),(7248990),(7009207),(7249076),(7249148),(7249157),(121023),(7009475),(121362),(7249454),(7009845),(7009848),(7009849),(121481),(121575),(7249572),(7249650),(121756),(7249820),(7010287),(7010288),(121846),(121949),(7010319),(7010320),(122016),(122044),(122121),(7010502),(7010671),(7098481),(7250195),(7250239),(7010804),(7010874),(122390),(122393),(122431),(7250291),(7250294),(7250295),(7250324),(7010960),(7010965),(122907),(7011182),(22578),(123066),(123082),(123089),(7011347),(7011348),(7250694),(7250701),(7250789),(123249),(7011463),(7011467),(7011565),(7011629),(7250885),(7250986),(7011716),(123563),(7251060),(7251255),(7012103),(7099782),(7251337),(7251350),(7251416),(124005),(124028),(124088),(124103),(7095396),(7095864),(7251641),(7012736),(7012737),(124473),(124485),(124563),(7251903),(7251979),(7012800),(7012845),(7012846),(7012859),(7012954),(7097385),(7097393),(7013125),(124868),(124875),(7252012),(7252027),(7013159),(7100912),(125320),(125322),(7013341),(7252383),(7252397),(7013700),(7252578),(7099729),(125613),(7013811),(125806),(7100391),(7100392),(7100500),(7014072),(126060),(7101452),(126185),(7101731),(7014494),(7014537),(7253324),(7014647),(7014653),(7102830),(7014726),(7014825),(7103202),(7253619),(7103597),(7015181),(7015183),(127198),(7015217),(7015314),(7015370),(127391),(7254049),(7015596),(127663),(127694),(7106299),(7015787),(7015788),(7015789),(7015949),(128055),(128127),(7254443),(7107261),(128221),(7254632),(7254652),(7254799),(7254800),(128424),(128428),(128729),(7016565),(7016606),(7016686),(7016890),(7016891),(7255011),(7255086),(7110165),(7017065),(7017066),(7017067),(7017071),(7017086),(7255289),(7104208),(129286),(7017181),(7255469),(7017366),(7017398),(129553),(129661),(7017485),(7017498),(7017648),(7111758),(129860),(7017658),(7112324),(129954),(130013),(68222),(7017873),(130117),(130196),(7255958),(7255969),(130416),(7256304),(7018304),(69834),(69922),(130605),(130606),(130608),(7105442),(7256333),(70102),(7018426),(130677),(130894),(7018693),(7018706),(7256585),(131149),(7256813),(7116004),(7116110),(7116199),(131235),(131237),(131342),(131343),(131361),(7116490),(7256871),(7256878),(7256899),(7256901),(7256907),(72453),(7256965),(7019178),(72810),(131740),(7019627),(7118345),(7257280),(132004),(132010),(7019911),(132188),(7257469),(7257544),(7257548),(7257734),(7257754),(7257758),(7020103),(7257846),(7257952),(132736),(7120683),(7258004),(7258011),(7258024),(7020674),(7020763),(7020840),(133141),(7107608),(7258194),(7258203),(7258374),(7021022),(133582),(133587),(133610),(7021067),(7021153),(7123143),(7123160),(133678),(7021317),(7021322),(7021325),(79787),(7123823),(80246),(133871),(133872),(7021444),(134089),(7108332),(7124547),(7259036),(7124733),(134361),(134376),(7021883),(7021900),(7021909),(81479),(81665),(81742),(134558),(7259131),(7259215),(7259307),(7125786),(7108726),(7021992),(7022005),(134631),(134632),(134715),(82529),(7259357),(7259362),(7022293),(7259501),(134932),(134937),(83173),(7022538),(7259529),(83561),(135185),(7127448),(135217),(7259709),(84090),(7259873),(7127919),(7259886),(7259896),(7260010),(7260053),(7260059),(85222),(7022969),(135570),(135593),(135668),(135678),(135679),(135784),(7023207),(85981),(7260101),(7129441),(86169),(7023345),(7023473),(7260265),(7260273),(7260274),(7129797),(136219),(7023502),(87201),(7260473),(7260482),(7260539),(136313),(87768),(87955),(7131147),(136631),(7260737),(88450),(136708),(136820),(7024160),(7024174),(7110701),(7260941),(88919),(88920),(89080),(136891),(137003),(89395),(7261016),(7261018),(7133091),(7133096),(7024554),(137276),(137376),(7261296),(7261322),(90796),(90804),(90953),(7133935),(91056),(91143),(7261403),(7261415),(7261486),(7261493),(7261551),(7025906),(7025926),(91346),(137805),(7111446),(7026021),(7026087),(7261572),(7261590),(7261676),(7261678),(7261679),(7261683),(137806),(137914),(92168),(92265),(7026303),(7026353),(7026365),(7026371),(7135724),(7026393),(7026479),(7026538),(138193),(138224),(7261949),(7261975),(7261981),(7261992),(7262073),(93708),(138468),(138469),(93886),(7136854),(94093),(138677),(94252),(7137230),(7137234),(94896),(7137811),(7026950),(7262418),(7137881),(138960),(138967),(7027299),(7262520),(7262522),(7262523),(7262534),(95753),(95762),(96124),(96397),(139340),(96681),(7027613),(139612),(97088),(7139765),(97262),(97337),(7027811),(97460),(139785),(139790),(139791),(98204),(7028157),(7141400),(140079),(140186),(99026),(99027),(99151),(7028290),(140371),(99528),(99636),(7028484),(140456),(140468),(140469),(7263643),(7028675),(7028676),(100442),(100747),(100748),(140836),(7143274),(7143726),(7143808),(101379),(101479),(101570),(141237),(102227),(102228),(102261),(7264303),(7264335),(7029501),(7029502),(7029508),(7029559),(7029561),(141595),(141671),(7264525),(7145885),(141872),(141890),(7029884),(7264600),(7264701),(141967),(142080),(142081),(7029993),(7029997),(142153),(142154),(142176),(7030268),(105374),(105522),(142436),(7115274),(7265137),(7265140),(105807),(105901),(7148159),(7148160),(142517),(106463),(142626),(7265166),(7030542),(7030543),(7030544),(7030546),(7030555),(106592),(107048),(7149185),(7149196),(142906),(142907),(7265345),(7265367),(107232),(107243),(107407),(7115958),(7030933),(107718),(107782),(107895),(7149957),(7030934),(7030935),(7030936),(7030939),(143194),(108050),(108262),(7265608),(7265626),(143273),(143361),(109197),(109205),(143485),(143551),(109370),(109410),(109416),(7265926),(109764),(109881),(7266005),(110422),(110611),(110625),(110713),(144115),(144118),(144152),(110910),(7266377),(144211),(7032117),(111816),(144494),(7117000),(111953),(112022),(7266574),(144673),(144691),(144700),(144757),(112504),(7032492),(112983),(113042),(7266773),(7266776),(144862),(7032635),(144954),(145055),(113439),(113522),(113723),(113740),(7266844),(7266856),(7266934),(7266941),(113833),(114183),(145162),(7267034),(7267138),(7032998),(145334),(145347),(145422),(114755),(114827),(115022),(115037),(115046),(115134),(115302),(115686),(115769),(115800),(7033373),(7033530),(115961),(115966),(116091),(145921),(7033567),(7033702),(116232),(116454),(116747),(146280),(146400),(7033917),(7033932),(146589),(146639),(7034275),(7034496),(147124),(147145),(147217),(147244),(147309),(7119408),(7035030),(7035031),(147581),(7035066),(147959),(147967),(7035533),(148254),(148272),(148274),(7035645),(7035775),(148449),(7035879),(7120357),(148533),(7036003),(7036165),(148940),(7036470),(149219),(149459),(149461),(7036849),(149563),(149591),(149592),(149648),(7037043),(149659),(149660),(149766),(149768),(7037149),(7037198),(7037200),(7037201),(7037230),(149879),(7037494),(150409),(150514),(150521),(7037777),(150600),(150720),(150723),(7038089),(7038142),(7038147),(151266),(151267),(151443),(151473),(7038804),(7123002),(7123090),(151839),(7039039),(7039040),(7039213),(7039302),(152118),(152133),(7039358),(7039363),(152387),(152399),(152407),(152756),(152757),(152794),(7039850),(153245),(153246),(153412),(153449),(153452),(7040790),(153832),(153911),(153921),(7124905),(7040920),(7041074),(154272),(154387),(154388),(7041348),(7202048),(154723),(7041470),(7041564),(7202147),(7041645),(7041646),(7041812),(7041813),(7125610),(155021),(155022),(155024),(155025),(7041860),(7041992),(7041993),(7041994),(7041995),(7202320),(7202499),(155135),(155204),(7042115),(7202523),(7202532),(7202679),(7202680),(7202682),(7042291),(7042306),(7202729),(7202778),(7042388),(7043396),(7043562),(155779),(7202906),(7203050),(7043684),(7043733),(7043739),(155880),(155883),(155989),(7203078),(7203246),(7043797),(7043868),(156161),(156174)
    
--     ;


-- -- Summary of row counts
-- SELECT 
--     (SELECT COUNT(*) FROM ssd_development.ssd_person1) AS row_count_ssd_person1,
--     (SELECT COUNT(*) FROM ssd_development.ssd_person2) AS row_count_ssd_person2,
--     (SELECT COUNT(*) FROM ssd_development.ssd_person3) AS row_count_ssd_person3,
--     (SELECT COUNT(*) FROM ssd_development.ssd_person4) AS row_count_ssd_person4;





-- -- Find pers_person_id present in any of the tables
-- -- 24171 records
-- -- SELECT pers_person_id, 'ssd_person1' AS source_table
-- -- FROM ssd_person1
-- -- UNION
-- SELECT pers_person_id, 'ssd_person2' AS source_table
-- FROM ssd_person2
-- UNION
-- SELECT pers_person_id, 'ssd_person3' AS source_table
-- FROM ssd_person3
-- UNION
-- SELECT pers_person_id, 'ssd_person4' AS source_table
-- FROM ssd_person4;




-- -- Find common pers_person_id across all tables
-- -- 712 records
-- -- SELECT pers_person_id 
-- -- FROM ssd_person1
-- -- INTERSECT
-- SELECT pers_person_id 
-- FROM ssd_person2
-- INTERSECT
-- SELECT pers_person_id 
-- FROM ssd_person3
-- INTERSECT
-- SELECT pers_person_id 
-- FROM ssd_person4;

-- -- alongisde the above, giving single count (712) of common ids
-- -- Summary of `pers_person_id` comparison
-- SELECT 
--     COUNT(DISTINCT p1.pers_person_id) AS common_in_all_tables
-- FROM 
--     ssd_person1 p1
-- INNER JOIN 
--     ssd_person2 p2 ON p1.pers_person_id = p2.pers_person_id
-- INNER JOIN 
--     ssd_person3 p3 ON p1.pers_person_id = p3.pers_person_id
-- INNER JOIN 
--     ssd_person4 p4 ON p1.pers_person_id = p4.pers_person_id;


-- SELECT pers_person_id
-- FROM ssd_development.ssd_person1
-- ORDER BY pers_person_id
-- -- OFFSET 0 ROWS FETCH NEXT 100000 ROWS ONLY;
-- -- OFFSET 100000 ROWS FETCH NEXT 100000 ROWS ONLY;
-- -- OFFSET 200000 ROWS FETCH NEXT 100000 ROWS ONLY;
-- OFFSET 300000 ROWS FETCH NEXT 100000 ROWS ONLY;


/* SSD extract set up */
DECLARE @ssd_timeframe_years INT = 6;

/* Check exists & drop */
IF OBJECT_ID('ssd_person') IS NOT NULL DROP TABLE ssd_person;
IF OBJECT_ID('tempdb..#ssd_person') IS NOT NULL DROP TABLE #ssd_person;

/* Create structure */
CREATE TABLE ssd_development.ssd_person (
    pers_person_id NVARCHAR(48) PRIMARY KEY  -- metadata={"item_ref":"PERS001A"}
);

/* Insert data */
INSERT INTO ssd_person (pers_person_id)
SELECT
    p.DIM_PERSON_ID
FROM
    Child_Social.DIM_PERSON AS p
WHERE 
    p.DIM_PERSON_ID IS NOT NULL
    AND p.DIM_PERSON_ID <> '-1'
    AND p.DIM_PERSON_ID <> -1
    AND (p.IS_CLIENT = 'Y'
        OR (
            EXISTS (
                SELECT 1 
                FROM Child_Social.FACT_CONTACTS fc
                WHERE fc.DIM_PERSON_ID = p.DIM_PERSON_ID
                AND fc.CONTACT_DTTM >= DATEADD(YEAR, -@ssd_timeframe_years, GETDATE())
            )
            OR EXISTS (
                SELECT 1 
                FROM Child_Social.FACT_REFERRALS fr
                WHERE fr.DIM_PERSON_ID = p.DIM_PERSON_ID
                AND (
                    fr.REFRL_START_DTTM >= DATEADD(YEAR, -@ssd_timeframe_years, GETDATE()) 
                    OR fr.REFRL_END_DTTM >= DATEADD(YEAR, -@ssd_timeframe_years, GETDATE()) 
                    OR fr.REFRL_END_DTTM IS NULL
                )
            )
            OR EXISTS (
                SELECT 1 FROM Child_Social.FACT_CLA_CARE_LEAVERS fccl
                WHERE fccl.DIM_PERSON_ID = p.DIM_PERSON_ID
                AND fccl.IN_TOUCH_DTTM >= DATEADD(YEAR, -@ssd_timeframe_years, GETDATE())
            )
            OR EXISTS (
                SELECT 1 FROM Child_Social.DIM_CLA_ELIGIBILITY dce
                WHERE dce.DIM_PERSON_ID = p.DIM_PERSON_ID
                AND dce.DIM_LOOKUP_ELIGIBILITY_STATUS_DESC IS NOT NULL
            )
            OR EXISTS (
                SELECT 1 FROM Child_Social.FACT_INVOLVEMENTS fi
                WHERE fi.DIM_PERSON_ID = p.DIM_PERSON_ID
                AND fi.[IS_ALLOCATED_CW_FLAG] = 'Y'
                AND fi.END_DTTM IS NULL
            )
        )
    );
